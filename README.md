# ğŸ¬ Watch Party - WebRTC ê¸°ë°˜ ì‹¤ì‹œê°„ ë™ì˜ìƒ ì‹œì²­ íŒŒí‹°

![Image](https://github.com/user-attachments/assets/1767f992-0195-4d7b-aca3-94c28adfcf3f)

> **React + Node.js + WebRTCë¥¼ í™œìš©í•œ ì‹¤ì‹œê°„ ì˜ìƒ ë™ê¸°í™” ë° ìŒì„± ì±„íŒ… ì„œë¹„ìŠ¤**

## ğŸ“‹ ëª©ì°¨
- [í”„ë¡œì íŠ¸ ê°œìš”](#-í”„ë¡œì íŠ¸-ê°œìš”)
- [WebRTC ê¸°ìˆ  ì¡°ì‚¬](#-webrtc-ê¸°ìˆ -ì¡°ì‚¬)
- [ì£¼ìš” ê¸°ëŠ¥](#-ì£¼ìš”-ê¸°ëŠ¥)
- [ê¸°ìˆ  ìŠ¤íƒ](#-ê¸°ìˆ -ìŠ¤íƒ)
- [ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜](#-ì‹œìŠ¤í…œ-ì•„í‚¤í…ì²˜)
- [í”„ë¡œì íŠ¸ êµ¬ì¡°](#-í”„ë¡œì íŠ¸-êµ¬ì¡°)
- [ì„¤ì¹˜ ë° ì‹¤í–‰ ë°©ë²•](#-ì„¤ì¹˜-ë°-ì‹¤í–‰-ë°©ë²•)
- [WebRTC êµ¬í˜„ ìƒì„¸](#-webrtc-êµ¬í˜„-ìƒì„¸)
- [ì£¼ìš” êµ¬í˜„ ì½”ë“œ](#-ì£¼ìš”-êµ¬í˜„-ì½”ë“œ)
- [ì°¸ê³  ìë£Œ](#-ì°¸ê³ -ìë£Œ)

---

## ğŸ“Œ í”„ë¡œì íŠ¸ ê°œìš”

### í”„ë¡œì íŠ¸ ì„ ì • ì´ìœ 
ê¸°ì¡´ì˜ í™”ìƒ ì±„íŒ… ì„œë¹„ìŠ¤ë¥¼ ë„˜ì–´, **ë™ì˜ìƒ ì½˜í…ì¸ ë¥¼ í•¨ê»˜ ì‹œì²­í•˜ë©° ì†Œí†µí•˜ëŠ” ê²½í—˜**ì„ ì œê³µí•˜ê³ ì í–ˆìŠµë‹ˆë‹¤. 
ì½”ë¡œë‚˜19 ì´í›„ ë¹„ëŒ€ë©´ ë¬¸í™”ê°€ ìë¦¬ì¡ìœ¼ë©´ì„œ, ë¬¼ë¦¬ì ìœ¼ë¡œ ë–¨ì–´ì ¸ ìˆì–´ë„ í•¨ê»˜ ì˜í™”ë‚˜ ì˜ìƒì„ ë³´ë©° 
ì‹¤ì‹œê°„ìœ¼ë¡œ ë°˜ì‘ì„ ê³µìœ í•˜ê³  ì‹¶ì–´í•˜ëŠ” ë‹ˆì¦ˆê°€ ì¦ê°€í–ˆìŠµë‹ˆë‹¤.

### í•µì‹¬ ëª©í‘œ
- âœ… **WebRTC ê¸°ìˆ ì˜ ì‹¤ì „ í™œìš©**: P2P ì—°ê²°, DataChannel, MediaStream API êµ¬í˜„
- âœ… **ì‹¤ì‹œê°„ ë™ê¸°í™”**: ë°€ë¦¬ì´ˆ ë‹¨ìœ„ì˜ ì •ë°€í•œ ë™ì˜ìƒ ì¬ìƒ ë™ê¸°í™”
- âœ… **ìŒì„± í†µì‹ **: WebRTCë¥¼ í†µí•œ ì €ì§€ì—° ì‹¤ì‹œê°„ ìŒì„± ì±„íŒ…
- âœ… **ì‹œê·¸ë„ë§ ì„œë²„**: Socket.io ê¸°ë°˜ ì—°ê²° ìˆ˜ë¦½ ë° ë°ì´í„° ì¤‘ê³„
- âœ… **í™•ì¥ ê°€ëŠ¥í•œ êµ¬ì¡°**: ì¶”í›„ ê¸°ëŠ¥ í™•ì¥ì´ ìš©ì´í•œ ì»´í¬ë„ŒíŠ¸ ì„¤ê³„

### ê³¼ì œ ì£¼ì œ ë¶„ë¥˜
**ğŸ¯ ì£¼ì œ 5: ììœ  ì£¼ì œ (WebRTCê°€ í•µì‹¬ì¸ ì„œë¹„ìŠ¤)**
- ì‹¤ì‹œê°„ ìŒì„± ì±„íŒ… (ì£¼ì œ 3)
- WebRTC ë°ì´í„° ì±„íŒ… (ì£¼ì œ 4)
- ìœ„ ë‘ ê°€ì§€ë¥¼ ê²°í•©í•˜ì—¬ **ë™ì˜ìƒ ë™ê¸°í™” ì‹œì²­ íŒŒí‹°**ë¼ëŠ” ì°¨ë³„í™”ëœ ì„œë¹„ìŠ¤ êµ¬í˜„

---

## ğŸ” WebRTC ê¸°ìˆ  ì¡°ì‚¬

### 1. WebRTCë€?

**WebRTC(Web Real-Time Communication)**ëŠ” ì›¹ ë¸Œë¼ìš°ì € ê°„ í”ŒëŸ¬ê·¸ì¸ ì—†ì´ 
**ìŒì„±, ì˜ìƒ, ë°ì´í„°ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ì£¼ê³ ë°›ì„ ìˆ˜ ìˆê²Œ í•˜ëŠ” ì˜¤í”ˆì†ŒìŠ¤ ê¸°ìˆ **ì…ë‹ˆë‹¤.

#### íŠ¹ì§•
- ğŸš€ **P2P(Peer-to-Peer) í†µì‹ **: ì„œë²„ë¥¼ ê±°ì¹˜ì§€ ì•Šê³  ì§ì ‘ ì—°ê²°
- ğŸ”’ **ë³´ì•ˆ**: DTLS/SRTP ê¸°ë°˜ ì•”í˜¸í™” í†µì‹ 
- ğŸ“± **í¬ë¡œìŠ¤ í”Œë«í¼**: ëª¨ë“  ì£¼ìš” ë¸Œë¼ìš°ì € ì§€ì›
- ğŸ’° **ë¬´ë£Œ**: ì˜¤í”ˆì†ŒìŠ¤ í”„ë¡œì íŠ¸

### 2. WebRTC êµ¬ì„± ìš”ì†Œ

#### 2.1 MediaStream (getUserMedia)
- ì¹´ë©”ë¼, ë§ˆì´í¬ ë“± ë¯¸ë””ì–´ ì¥ì¹˜ ì ‘ê·¼
- ë¯¸ë””ì–´ íŠ¸ë™(Track) ê´€ë¦¬
```javascript
const stream = await navigator.mediaDevices.getUserMedia({ 
  audio: true, 
  video: true 
});
```

#### 2.2 RTCPeerConnection
- P2P ì—°ê²°ì˜ í•µì‹¬ API
- ìŒì„±/ì˜ìƒ ë°ì´í„° ì†¡ìˆ˜ì‹ 
- ICE, SDP ì²˜ë¦¬
```javascript
const pc = new RTCPeerConnection(configuration);
```

#### 2.3 RTCDataChannel
- í…ìŠ¤íŠ¸, íŒŒì¼ ë“± ì„ì˜ì˜ ë°ì´í„° ì „ì†¡
- ë‚®ì€ ì§€ì—°ì‹œê°„
- ì‹ ë¢°ì„±/ë¹„ì‹ ë¢°ì„± ëª¨ë“œ ì„ íƒ ê°€ëŠ¥
```javascript
const dataChannel = pc.createDataChannel('chat');
```

### 3. ì‹œê·¸ë„ë§ ì„œë²„ì˜ ì—­í• 

WebRTCëŠ” P2P í†µì‹ ì´ì§€ë§Œ, **ì²˜ìŒ ì—°ê²°ì„ ë§ºê¸° ìœ„í•´ì„œëŠ” ì‹œê·¸ë„ë§ ì„œë²„ê°€ í•„ìš”**í•©ë‹ˆë‹¤.

#### ì‹œê·¸ë„ë§ ì„œë²„ê°€ í•˜ëŠ” ì¼
1. **SDP(Session Description Protocol) êµí™˜**
   - Offer/Answer ë©”ì‹œì§€ ì „ë‹¬
   - ì§€ì› ì½”ë±, ë¯¸ë””ì–´ ì •ë³´ êµí™˜

2. **ICE Candidate êµí™˜**
   - ë„¤íŠ¸ì›Œí¬ ê²½ë¡œ ì •ë³´ ì „ë‹¬
   - ìµœì ì˜ ì—°ê²° ê²½ë¡œ íƒìƒ‰

3. **ë°© ê´€ë¦¬**
   - ì‚¬ìš©ì ì…ì¥/í‡´ì¥ ì•Œë¦¼
   - ì°¸ì—¬ì ëª©ë¡ ê´€ë¦¬

**ë³¸ í”„ë¡œì íŠ¸ì—ì„œëŠ” Socket.ioë¥¼ ì‹œê·¸ë„ë§ ì„œë²„ë¡œ í™œìš©**

### 4. STUN / TURN ì„œë²„

#### STUN (Session Traversal Utilities for NAT)
- **ì—­í• **: ê³µì¸ IP ì£¼ì†Œ í™•ì¸
- **ì‚¬ìš© ì‹œê¸°**: NAT ë’¤ì— ìˆëŠ” í´ë¼ì´ì–¸íŠ¸ì˜ ì™¸ë¶€ ì£¼ì†Œ íƒìƒ‰
- **ë¹„ìš©**: ë¬´ë£Œ (Google ê³µê°œ STUN ì„œë²„ ì‚¬ìš©)

```javascript
{
  iceServers: [
    { urls: 'stun:stun.l.google.com:19302' }
  ]
}
```

#### TURN (Traversal Using Relays around NAT)
- **ì—­í• **: ì§ì ‘ ì—°ê²° ì‹¤íŒ¨ ì‹œ ì¤‘ê³„ ì„œë²„ ì—­í• 
- **ì‚¬ìš© ì‹œê¸°**: ë°©í™”ë²½ì´ ê°•ë ¥í•œ ê²½ìš° (ì•½ 10-20%)
- **ë¹„ìš©**: ì„œë²„ ìš´ì˜ ë¹„ìš© ë°œìƒ

**ë³¸ í”„ë¡œì íŠ¸ì—ì„œëŠ” STUNë§Œ ì‚¬ìš©** (ë¡œì»¬ ë„¤íŠ¸ì›Œí¬ í…ŒìŠ¤íŠ¸ í™˜ê²½)

### 5. WebRTC ì—°ê²° íë¦„ë„

```
[ì‚¬ìš©ì A]                    [ì‹œê·¸ë„ë§ ì„œë²„]                    [ì‚¬ìš©ì B]
    |                                |                                |
    |-------- join-room ----------->|                                |
    |                                |<-------- join-room ------------|
    |                                |                                |
    |                                |------- user-joined ----------->|
    |                                |                                |
    |<------------------------------- Offer --------------------------|
    |                                |                                |
    |-------- Answer -------------->|                                |
    |                                |------- Answer ---------------->|
    |                                |                                |
    |<-------- ICE Candidate --------|-------- ICE Candidate -------->|
    |                                |                                |
    |                                |                                |
    |<=================== P2P Connection Established ================>|
    |                                                                 |
    |<------------------ Audio/Data Stream --------------------------->|
```

### 6. ì—°ê²° ê³¼ì • ìƒì„¸

#### Step 1: í”¼ì–´ ì—°ê²° ìƒì„±
```javascript
const pc = new RTCPeerConnection({
  iceServers: [
    { urls: 'stun:stun.l.google.com:19302' }
  ]
});
```

#### Step 2: Offer ìƒì„± (í˜¸ì¶œì)
```javascript
const offer = await pc.createOffer();
await pc.setLocalDescription(offer);
socket.emit('offer', { target: userId, offer });
```

#### Step 3: Answer ìƒì„± (ìˆ˜ì‹ ì)
```javascript
await pc.setRemoteDescription(offer);
const answer = await pc.createAnswer();
await pc.setLocalDescription(answer);
socket.emit('answer', { target: userId, answer });
```

#### Step 4: ICE Candidate êµí™˜
```javascript
pc.onicecandidate = (event) => {
  if (event.candidate) {
    socket.emit('ice-candidate', {
      target: userId,
      candidate: event.candidate
    });
  }
};
```

#### Step 5: ì—°ê²° ì™„ë£Œ
```javascript
pc.onconnectionstatechange = () => {
  if (pc.connectionState === 'connected') {
    console.log('P2P ì—°ê²° ì„±ê³µ!');
  }
};
```

---

## âœ¨ ì£¼ìš” ê¸°ëŠ¥

### 1ï¸âƒ£ ì‹¤ì‹œê°„ ë™ì˜ìƒ ë™ê¸°í™” (DataChannel í™œìš©)
- YouTube ë™ì˜ìƒ URL ì…ë ¥ ì‹œ ìë™ ë¡œë“œ
- ì¬ìƒ/ì¼ì‹œì •ì§€/íƒìƒ‰ ì´ë²¤íŠ¸ë¥¼ **ë°€ë¦¬ì´ˆ ë‹¨ìœ„ë¡œ ë™ê¸°í™”**
- RTCDataChannelì„ í†µí•œ ì €ì§€ì—° ì œì–´ ëª…ë ¹ ì „ì†¡
- ì°¸ì—¬ì ì „ì›ì´ ë™ì¼í•œ ì‹œì ì„ ì‹œì²­

**êµ¬í˜„ ë°©ì‹:**
```javascript
// ì¬ìƒ ëª…ë ¹ ì „ì†¡
dataChannel.send(JSON.stringify({
  type: 'play',
  currentTime: player.getCurrentTime()
}));

// ëª…ë ¹ ìˆ˜ì‹  ë° ì‹¤í–‰
dataChannel.onmessage = (event) => {
  const data = JSON.parse(event.data);
  if (data.type === 'play') {
    player.seekTo(data.currentTime);
    player.playVideo();
  }
};
```

### 2ï¸âƒ£ ì‹¤ì‹œê°„ ìŒì„± ì±„íŒ… (MediaStream í™œìš©)
- WebRTC ì˜¤ë””ì˜¤ ìŠ¤íŠ¸ë¦¼ì„ í†µí•œ ìŒì„± ëŒ€í™”
- ë§ˆì´í¬ On/Off í† ê¸€ ê¸°ëŠ¥
- ì°¸ì—¬ìë³„ ìŒì„± í™œì„± ìƒíƒœ í‘œì‹œ
- ì—ì½” ìº”ìŠ¬ë ˆì´ì…˜ ë° ë…¸ì´ì¦ˆ ì œê±° ì ìš©

**êµ¬í˜„ ë°©ì‹:**
```javascript
// ë§ˆì´í¬ ìŠ¤íŠ¸ë¦¼ íšë“
const stream = await navigator.mediaDevices.getUserMedia({
  audio: {
    echoCancellation: true,
    noiseSuppression: true,
    autoGainControl: true
  }
});

// ëª¨ë“  í”¼ì–´ì—ê²Œ ì˜¤ë””ì˜¤ íŠ¸ë™ ì „ì†¡
stream.getTracks().forEach(track => {
  peerConnections.forEach(pc => {
    pc.addTrack(track, stream);
  });
});
```

### 3ï¸âƒ£ ì‹¤ì‹œê°„ í…ìŠ¤íŠ¸ ì±„íŒ… (DataChannel í™œìš©)
- WebRTC DataChannelì„ í†µí•œ P2P ì±„íŒ…
- ì„œë²„ë¥¼ ê±°ì¹˜ì§€ ì•Šì•„ **ì§€ì—°ì‹œê°„ ìµœì†Œí™”**
- ì±„íŒ… íˆìŠ¤í† ë¦¬ ê´€ë¦¬
- ì´ëª¨ì§€ ë°˜ì‘ ê¸°ëŠ¥ (ğŸ‘ ğŸ˜‚ â¤ï¸ ğŸ”¥ ğŸ˜® ğŸ‰)

### 4ï¸âƒ£ ë°© ìƒì„± ë° ì°¸ì—¬ ì‹œìŠ¤í…œ
- ê³ ìœ í•œ ë°© ID ìë™ ìƒì„±
- í´ë¦½ë³´ë“œ ë³µì‚¬ ê¸°ëŠ¥
- ì°¸ì—¬ì ì‹¤ì‹œê°„ ëª©ë¡ í‘œì‹œ
- ì…ì¥/í‡´ì¥ ì•Œë¦¼

---

## ğŸ›  ê¸°ìˆ  ìŠ¤íƒ

### Frontend
| ê¸°ìˆ  | ë²„ì „ | ìš©ë„ |
|------|------|------|
| React | 18.x | UI í”„ë ˆì„ì›Œí¬ |
| Vite | 5.x | ë¹Œë“œ ë„êµ¬ ë° ê°œë°œ ì„œë²„ |
| Socket.io Client | 4.x | ì‹œê·¸ë„ë§ í†µì‹  |
| React YouTube | 10.x | YouTube Player API ë˜í¼ |
| WebRTC API | Native | P2P í†µì‹  |

### Backend
| ê¸°ìˆ  | ë²„ì „ | ìš©ë„ |
|------|------|------|
| Node.js | 18.x | ëŸ°íƒ€ì„ í™˜ê²½ |
| Express | 4.x | ì›¹ ì„œë²„ í”„ë ˆì„ì›Œí¬ |
| Socket.io | 4.x | WebSocket ì‹œê·¸ë„ë§ ì„œë²„ |
| CORS | - | Cross-Origin ìš”ì²­ ì²˜ë¦¬ |

### ê°œë°œ ë„êµ¬
- Git & GitHub (ë²„ì „ ê´€ë¦¬ ë° í˜‘ì—…)
- ESLint (ì½”ë“œ í’ˆì§ˆ ê´€ë¦¬)
- Chrome DevTools (ë””ë²„ê¹…)

---

## ğŸ— ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### ì „ì²´ êµ¬ì¡°ë„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         í´ë¼ì´ì–¸íŠ¸ A                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ VideoPlayer  â”‚  â”‚     Chat     â”‚  â”‚  VoiceChat   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚         â”‚                  â”‚                  â”‚              â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                            â”‚                                 â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚                    â”‚  RTCPeerConn   â”‚                        â”‚
â”‚                    â”‚  - DataChannel â”‚â—„â”€â”€â”€â”€â”                  â”‚
â”‚                    â”‚  - AudioTrack  â”‚     â”‚                  â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚              â”‚
                    Socket.ioâ”‚              â”‚ WebRTC P2P
                             â”‚              â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
                â”‚      ì‹œê·¸ë„ë§ ì„œë²„ (Node.js)     â”‚
                â”‚  - Socket.io                     â”‚
                â”‚  - ë°© ê´€ë¦¬                       â”‚
                â”‚  - Offer/Answer ì¤‘ê³„             â”‚
                â”‚  - ICE Candidate ì¤‘ê³„            â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                    Socket.ioâ”‚              WebRTC P2P
                             â”‚              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚                  â”‚
â”‚                    â”‚  RTCPeerConn   â”‚â—„â”€â”€â”€â”€â”˜                  â”‚
â”‚                    â”‚  - DataChannel â”‚                        â”‚
â”‚                    â”‚  - AudioTrack  â”‚                        â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                            â”‚                                 â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚         â”‚                  â”‚                  â”‚              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ VideoPlayer  â”‚  â”‚     Chat     â”‚  â”‚  VoiceChat   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                         í´ë¼ì´ì–¸íŠ¸ B                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë„¤íŠ¸ì›Œí¬ í† í´ë¡œì§€

**Full Mesh ë°©ì‹ ì±„íƒ**
- ëª¨ë“  ì°¸ì—¬ìê°€ ì„œë¡œ ì§ì ‘ ì—°ê²° (P2P)
- ì¥ì : ë‚®ì€ ì§€ì—°ì‹œê°„, ì„œë²„ ë¶€ë‹´ ìµœì†Œí™”
- ë‹¨ì : ì°¸ì—¬ì ì¦ê°€ ì‹œ ì—°ê²° ìˆ˜ ê¸‰ì¦ (n Ã— (n-1) / 2)
- ê¶Œì¥ ì¸ì›: 5-6ëª… ì´í•˜

```
     [User A]
       / \
      /   \
    [B]â”€â”€[C]
     â”‚    â”‚
    [D]â”€â”€[E]

5ëª… = 10ê°œ ì—°ê²°
```

---

## ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
webrtc-task/
â”œâ”€â”€ ğŸ“‚ client/                          # React í”„ë¡ íŠ¸ì—”ë“œ
â”‚   â”œâ”€â”€ ğŸ“‚ public/
â”‚   â”‚   â””â”€â”€ vite.svg
â”‚   â”œâ”€â”€ ğŸ“‚ src/
â”‚   â”‚   â”œâ”€â”€ ğŸ“‚ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ JoinRoom.jsx            # ë°© ìƒì„±/ì°¸ì—¬ ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â”‚   â”œâ”€â”€ PartyRoom.jsx           # ë©”ì¸ ì‹œì²­ í™”ë©´
â”‚   â”‚   â”‚   â”œâ”€â”€ VideoPlayer.jsx         # YouTube í”Œë ˆì´ì–´
â”‚   â”‚   â”‚   â””â”€â”€ Chat.jsx                # ì±„íŒ… ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â”œâ”€â”€ ğŸ“‚ hooks/
â”‚   â”‚   â”‚   â””â”€â”€ useWebRTC.js            # WebRTC ë¡œì§ ì»¤ìŠ¤í…€ í›…
â”‚   â”‚   â”œâ”€â”€ App.jsx                     # ë£¨íŠ¸ ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â”œâ”€â”€ App.css                     # ì „ì—­ ìŠ¤íƒ€ì¼
â”‚   â”‚   â”œâ”€â”€ index.css                   # ê¸°ë³¸ ìŠ¤íƒ€ì¼
â”‚   â”‚   â””â”€â”€ main.jsx                    # ì—”íŠ¸ë¦¬ í¬ì¸íŠ¸
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ vite.config.js                  # Vite ì„¤ì •
â”‚
â”œâ”€â”€ ğŸ“‚ server/                          # Node.js ë°±ì—”ë“œ
â”‚   â”œâ”€â”€ server.js                       # Express + Socket.io ì„œë²„
â”‚   â””â”€â”€ package.json
â”‚
â””â”€â”€ README.md                           # í”„ë¡œì íŠ¸ ë¬¸ì„œ
```

### ì£¼ìš” íŒŒì¼ ì„¤ëª…

#### Frontend

**`JoinRoom.jsx`**
- ì—­í• : ì´ˆê¸° ì§„ì… í™”ë©´
- ê¸°ëŠ¥: ë‹‰ë„¤ì„ ì…ë ¥, ë°© ìƒì„±/ì°¸ì—¬
- Socket.io ì—°ê²° ì´ˆê¸°í™”

**`PartyRoom.jsx`**
- ì—­í• : ë©”ì¸ ì‹œì²­ í™”ë©´ ì»¨í…Œì´ë„ˆ
- ê¸°ëŠ¥: ë ˆì´ì•„ì›ƒ ê´€ë¦¬, WebRTC ì—°ê²° ì œì–´
- ì°¸ì—¬ì ëª©ë¡ ë° ìƒíƒœ í‘œì‹œ

**`VideoPlayer.jsx`**
- ì—­í• : YouTube í”Œë ˆì´ì–´ ì œì–´
- ê¸°ëŠ¥: ë™ì˜ìƒ ì¬ìƒ/ì¼ì‹œì •ì§€/íƒìƒ‰ ì´ë²¤íŠ¸ ì²˜ë¦¬
- DataChannelì„ í†µí•œ ë™ê¸°í™” ëª…ë ¹ ì†¡ìˆ˜ì‹ 

**`Chat.jsx`**
- ì—­í• : ì±„íŒ… ì¸í„°í˜ì´ìŠ¤
- ê¸°ëŠ¥: ë©”ì‹œì§€ ì…ë ¥/ì „ì†¡, ì´ëª¨ì§€ ë°˜ì‘
- ì±„íŒ… íˆìŠ¤í† ë¦¬ í‘œì‹œ

**`useWebRTC.js`**
- ì—­í• : WebRTC ë¡œì§ ìº¡ìŠí™”
- ê¸°ëŠ¥:
  - RTCPeerConnection ìƒì„± ë° ê´€ë¦¬
  - Offer/Answer/ICE Candidate ì²˜ë¦¬
  - ì˜¤ë””ì˜¤ ìŠ¤íŠ¸ë¦¼ ê´€ë¦¬
  - DataChannel í†µì‹ 

#### Backend

**`server.js`**
- Express ì›¹ ì„œë²„ êµ¬ë™
- Socket.io ì‹œê·¸ë„ë§ ì„œë²„
- ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬:
  - `join-room`: ë°© ì…ì¥ ì²˜ë¦¬
  - `offer`: WebRTC Offer ì¤‘ê³„
  - `answer`: WebRTC Answer ì¤‘ê³„
  - `ice-candidate`: ICE Candidate ì¤‘ê³„
  - `disconnect`: ì‚¬ìš©ì í‡´ì¥ ì²˜ë¦¬

---

## ğŸš€ ì„¤ì¹˜ ë° ì‹¤í–‰ ë°©ë²•

### ì‚¬ì „ ìš”êµ¬ì‚¬í•­
- Node.js 18.x ì´ìƒ
- npm ë˜ëŠ” yarn
- ëª¨ë˜ ì›¹ ë¸Œë¼ìš°ì € (Chrome, Firefox, Edge)

### 1. ì €ì¥ì†Œ í´ë¡ 

```bash
git clone https://github.com/soominn/webrtc-task.git
cd webrtc-task
```

### 2. ì„œë²„ ì‹¤í–‰

```bash
# ì„œë²„ ë””ë ‰í† ë¦¬ë¡œ ì´ë™
cd server

# ì˜ì¡´ì„± ì„¤ì¹˜
npm install

# ì„œë²„ ì‹œì‘
npm start
```

**ì‹¤í–‰ ê²°ê³¼:**
```
ì„œë²„ê°€ http://localhost:3001 ì—ì„œ ì‹¤í–‰ ì¤‘ì…ë‹ˆë‹¤.
```

**ì„œë²„ ì˜ì¡´ì„± (server/package.json):**
```json
{
  "dependencies": {
    "express": "^4.18.2",
    "socket.io": "^4.6.1",
    "cors": "^2.8.5"
  }
}
```

### 3. í´ë¼ì´ì–¸íŠ¸ ì‹¤í–‰

**ìƒˆ í„°ë¯¸ë„ ì°½ì„ ì—´ì–´ì„œ:**

```bash
# í´ë¼ì´ì–¸íŠ¸ ë””ë ‰í† ë¦¬ë¡œ ì´ë™
cd client

# ì˜ì¡´ì„± ì„¤ì¹˜
npm install

# ê°œë°œ ì„œë²„ ì‹œì‘
npm run dev
```

**ì‹¤í–‰ ê²°ê³¼:**
```
  VITE v5.x.x  ready in xxx ms

  âœ  Local:   http://localhost:3000/
  âœ  Network: use --host to expose
```

**í´ë¼ì´ì–¸íŠ¸ ì˜ì¡´ì„± (client/package.json):**
```json
{
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "socket.io-client": "^4.6.1",
    "react-youtube": "^10.1.0"
  },
  "devDependencies": {
    "vite": "^5.0.0",
    "@vitejs/plugin-react": "^4.2.0"
  }
}
```

### 4. ë¸Œë¼ìš°ì €ì—ì„œ ì ‘ì†

1. **ì²« ë²ˆì§¸ ì‚¬ìš©ì** (ë°© ìƒì„±):
   ```
   http://localhost:3000 ì ‘ì†
   â†’ ë‹‰ë„¤ì„ ì…ë ¥ (ì˜ˆ: "Alice")
   â†’ "ë°© ìƒì„±í•˜ê¸°" í´ë¦­
   â†’ ë°© ID ìë™ ë³µì‚¬ë¨ (ì˜ˆ: "abc123")
   ```

2. **ë‘ ë²ˆì§¸ ì‚¬ìš©ì** (ë°© ì°¸ì—¬):
   ```
   ìƒˆ ë¸Œë¼ìš°ì € íƒ­ ë˜ëŠ” ì‹œí¬ë¦¿ ëª¨ë“œë¡œ http://localhost:3000 ì ‘ì†
   â†’ "ë°© ì°¸ì—¬í•˜ê¸°" íƒ­ ì„ íƒ
   â†’ ë‹‰ë„¤ì„ ì…ë ¥ (ì˜ˆ: "Bob")
   â†’ ë°© ID ì…ë ¥ (ì˜ˆ: "abc123")
   â†’ "ë°© ì°¸ì—¬í•˜ê¸°" í´ë¦­
   ```

3. **ë™ì˜ìƒ ì‹œì²­**:
   ```
   YouTube URL ì…ë ¥ (ì˜ˆ: https://www.youtube.com/watch?v=dQw4w9WgXcQ)
   â†’ "ë™ì˜ìƒ ë¶ˆëŸ¬ì˜¤ê¸°" í´ë¦­
   â†’ ìŒì„± ì±„íŒ… ì‹œì‘
   â†’ í•¨ê»˜ ì‹œì²­!
   ```

---

## ğŸ”§ WebRTC êµ¬í˜„ ìƒì„¸

### 1. PeerConnection ìƒì„± ë° ê´€ë¦¬

**ìœ„ì¹˜:** `client/src/hooks/useWebRTC.js`

```javascript
const createPeerConnection = (userId) => {
  const configuration = {
    iceServers: [
      { urls: 'stun:stun.l.google.com:19302' },
      { urls: 'stun:stun1.l.google.com:19302' }
    ]
  };

  const pc = new RTCPeerConnection(configuration);

  // ICE Candidate ì´ë²¤íŠ¸ ì²˜ë¦¬
  pc.onicecandidate = (event) => {
    if (event.candidate) {
      socket.emit('ice-candidate', {
        target: userId,
        candidate: event.candidate
      });
    }
  };

  // ì—°ê²° ìƒíƒœ ëª¨ë‹ˆí„°ë§
  pc.onconnectionstatechange = () => {
    console.log(`Connection state: ${pc.connectionState}`);
  };

  // ì›ê²© ì˜¤ë””ì˜¤ íŠ¸ë™ ìˆ˜ì‹ 
  pc.ontrack = (event) => {
    const [remoteStream] = event.streams;
    // ì˜¤ë””ì˜¤ ì¬ìƒ ì²˜ë¦¬
    playRemoteAudio(remoteStream);
  };

  return pc;
};
```

### 2. DataChannel ìƒì„± ë° ë™ê¸°í™”

**ë™ì˜ìƒ ì œì–´ ë©”ì‹œì§€ í˜•ì‹:**
```javascript
{
  type: 'play' | 'pause' | 'seek',
  currentTime: number,
  timestamp: number
}
```

**ì†¡ì‹  ì¸¡ (VideoPlayer.jsx):**
```javascript
const handlePlay = () => {
  const message = {
    type: 'play',
    currentTime: playerRef.current.getCurrentTime(),
    timestamp: Date.now()
  };

  // ëª¨ë“  DataChannelì— ì „ì†¡
  Object.values(dataChannels).forEach(dc => {
    if (dc.readyState === 'open') {
      dc.send(JSON.stringify(message));
    }
  });
};
```

**ìˆ˜ì‹  ì¸¡:**
```javascript
dataChannel.onmessage = (event) => {
  const data = JSON.parse(event.data);
  const latency = Date.now() - data.timestamp;

  switch(data.type) {
    case 'play':
      playerRef.current.seekTo(data.currentTime + latency / 1000);
      playerRef.current.playVideo();
      break;
    case 'pause':
      playerRef.current.pauseVideo();
      break;
    case 'seek':
      playerRef.current.seekTo(data.currentTime);
      break;
  }
};
```

### 3. ì˜¤ë””ì˜¤ ìŠ¤íŠ¸ë¦¼ ì²˜ë¦¬

**ë§ˆì´í¬ ìŠ¤íŠ¸ë¦¼ íšë“:**
```javascript
const startVoiceChat = async () => {
  try {
    const stream = await navigator.mediaDevices.getUserMedia({
      audio: {
        echoCancellation: true,      // ì—ì½” ì œê±°
        noiseSuppression: true,       // ë°°ê²½ ì†ŒìŒ ì œê±°
        autoGainControl: true,        // ìë™ ë³¼ë¥¨ ì¡°ì ˆ
        sampleRate: 48000            // ê³ í’ˆì§ˆ ìƒ˜í”Œë ˆì´íŠ¸
      }
    });

    setLocalStream(stream);

    // ëª¨ë“  í”¼ì–´ì—ê²Œ ì˜¤ë””ì˜¤ íŠ¸ë™ ì¶”ê°€
    stream.getTracks().forEach(track => {
      Object.values(peerConnections).forEach(pc => {
        const sender = pc.addTrack(track, stream);
        senders.push(sender);
      });
    });

  } catch (error) {
    console.error('ë§ˆì´í¬ ì ‘ê·¼ ì‹¤íŒ¨:', error);
    alert('ë§ˆì´í¬ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”.');
  }
};
```

**ë§ˆì´í¬ ìŒì†Œê±° í† ê¸€:**
```javascript
const toggleMute = () => {
  if (localStream) {
    localStream.getAudioTracks().forEach(track => {
      track.enabled = !track.enabled;
    });
    setIsMuted(!isMuted);
  }
};
```

### 4. ì‹œê·¸ë„ë§ í”„ë¡œí† ì½œ

**ì„œë²„ ì¸¡ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ (server/server.js):**

```javascript
io.on('connection', (socket) => {
  console.log('ìƒˆë¡œìš´ ì‚¬ìš©ì ì—°ê²°:', socket.id);

  // ë°© ì°¸ì—¬
  socket.on('join-room', ({ roomId, userId, userName }) => {
    socket.join(roomId);
    
    // ë°©ì— ìˆëŠ” ë‹¤ë¥¸ ì‚¬ìš©ìë“¤ì—ê²Œ ì•Œë¦¼
    socket.to(roomId).emit('user-joined', {
      userId,
      userName
    });

    // í˜„ì¬ ë°© ì°¸ì—¬ì ëª©ë¡ ì „ì†¡
    const clients = io.sockets.adapter.rooms.get(roomId);
    socket.emit('room-users', Array.from(clients || []));
  });

  // Offer ì¤‘ê³„
  socket.on('offer', ({ target, offer }) => {
    io.to(target).emit('offer', {
      sender: socket.id,
      offer
    });
  });

  // Answer ì¤‘ê³„
  socket.on('answer', ({ target, answer }) => {
    io.to(target).emit('answer', {
      sender: socket.id,
      answer
    });
  });

  // ICE Candidate ì¤‘ê³„
  socket.on('ice-candidate', ({ target, candidate }) => {
    io.to(target).emit('ice-candidate', {
      sender: socket.id,
      candidate
    });
  });

  // ì—°ê²° í•´ì œ
  socket.on('disconnect', () => {
    io.emit('user-left', socket.id);
  });
});
```

---

## ğŸ’» ì£¼ìš” êµ¬í˜„ ì½”ë“œ

### useWebRTC Hook (í•µì‹¬ ë¡œì§)

**`client/src/hooks/useWebRTC.js`**

```javascript
import { useEffect, useRef, useState } from 'react';
import { io } from 'socket.io-client';

export const useWebRTC = (roomId, userId) => {
  const [socket, setSocket] = useState(null);
  const [localStream, setLocalStream] = useState(null);
  const [remoteStreams, setRemoteStreams] = useState({});
  const peerConnections = useRef({});
  const dataChannels = useRef({});

  useEffect(() => {
    // Socket.io ì—°ê²°
    const newSocket = io('http://localhost:3001');
    setSocket(newSocket);

    newSocket.emit('join-room', { roomId, userId });

    // ìƒˆ ì‚¬ìš©ì ì°¸ì—¬ ì‹œ
    newSocket.on('user-joined', async ({ userId: newUserId }) => {
      const pc = createPeerConnection(newUserId);
      peerConnections.current[newUserId] = pc;

      // DataChannel ìƒì„±
      const dc = pc.createDataChannel('sync');
      dataChannels.current[newUserId] = dc;
      setupDataChannel(dc);

      // Offer ìƒì„± ë° ì „ì†¡
      const offer = await pc.createOffer();
      await pc.setLocalDescription(offer);
      newSocket.emit('offer', { target: newUserId, offer });
    });

    // Offer ìˆ˜ì‹ 
    newSocket.on('offer', async ({ sender, offer }) => {
      const pc = createPeerConnection(sender);
      peerConnections.current[sender] = pc;

      // DataChannel ìˆ˜ì‹  ëŒ€ê¸°
      pc.ondatachannel = (event) => {
        dataChannels.current[sender] = event.channel;
        setupDataChannel(event.channel);
      };

      await pc.setRemoteDescription(new RTCSessionDescription(offer));
      const answer = await pc.createAnswer();
      await pc.setLocalDescription(answer);
      newSocket.emit('answer', { target: sender, answer });
    });

    // Answer ìˆ˜ì‹ 
    newSocket.on('answer', async ({ sender, answer }) => {
      const pc = peerConnections.current[sender];
      await pc.setRemoteDescription(new RTCSessionDescription(answer));
    });

    // ICE Candidate ìˆ˜ì‹ 
    newSocket.on('ice-candidate', async ({ sender, candidate }) => {
      const pc = peerConnections.current[sender];
      await pc.addIceCandidate(new RTCIceCandidate(candidate));
    });

    return () => {
      newSocket.disconnect();
      Object.values(peerConnections.current).forEach(pc => pc.close());
    };
  }, [roomId, userId]);

  const createPeerConnection = (userId) => {
    const pc = new RTCPeerConnection({
      iceServers: [
        { urls: 'stun:stun.l.google.com:19302' }
      ]
    });

    pc.onicecandidate = (event) => {
      if (event.candidate && socket) {
        socket.emit('ice-candidate', {
          target: userId,
          candidate: event.candidate
        });
      }
    };

    pc.ontrack = (event) => {
      setRemoteStreams(prev => ({
        ...prev,
        [userId]: event.streams[0]
      }));
    };

    return pc;
  };

  const setupDataChannel = (dc) => {
    dc.onopen = () => console.log('DataChannel opened');
    dc.onmessage = (event) => {
      // ë™ì˜ìƒ ë™ê¸°í™” ë©”ì‹œì§€ ì²˜ë¦¬
      const data = JSON.parse(event.data);
      handleSyncMessage(data);
    };
  };

  const sendSyncMessage = (message) => {
    Object.values(dataChannels.current).forEach(dc => {
      if (dc.readyState === 'open') {
        dc.send(JSON.stringify(message));
      }
    });
  };

  const startVoiceChat = async () => {
    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
    setLocalStream(stream);

    stream.getTracks().forEach(track => {
      Object.values(peerConnections.current).forEach(pc => {
        pc.addTrack(track, stream);
      });
    });
  };

  return {
    socket,
    localStream,
    remoteStreams,
    sendSyncMessage,
    startVoiceChat
  };
};
```

### VideoPlayer Component

**`client/src/components/VideoPlayer.jsx`**

```javascript
import React, { useRef, useEffect } from 'react';
import YouTube from 'react-youtube';

export const VideoPlayer = ({ videoId, sendSyncMessage, onSyncMessage }) => {
  const playerRef = useRef(null);
  const isLocalAction = useRef(false);

  useEffect(() => {
    // ë™ê¸°í™” ë©”ì‹œì§€ ìˆ˜ì‹  ë¦¬ìŠ¤ë„ˆ
    const handleSync = (data) => {
      if (isLocalAction.current) {
        isLocalAction.current = false;
        return;
      }

      const player = playerRef.current;
      if (!player) return;

      switch(data.type) {
        case 'play':
          player.seekTo(data.currentTime);
          player.playVideo();
          break;
        case 'pause':
          player.pauseVideo();
          break;
        case 'seek':
          player.seekTo(data.currentTime);
          break;
      }
    };

    onSyncMessage(handleSync);
  }, [onSyncMessage]);

  const handleStateChange = (event) => {
    isLocalAction.current = true;
    const player = event.target;

    const message = {
      currentTime: player.getCurrentTime(),
      timestamp: Date.now()
    };

    switch(event.data) {
      case 1: // Playing
        sendSyncMessage({ ...message, type: 'play' });
        break;
      case 2: // Paused
        sendSyncMessage({ ...message, type: 'pause' });
        break;
    }
  };

  const opts = {
    height: '100%',
    width: '100%',
    playerVars: {
      autoplay: 0,
    },
  };

  return (
    <div className="video-container">
      <YouTube
        videoId={videoId}
        opts={opts}
        onReady={(e) => { playerRef.current = e.target; }}
        onStateChange={handleStateChange}
      />
    </div>
  );
};
```

---

## ğŸ“š ì°¸ê³  ìë£Œ

### ê³µì‹ ë¬¸ì„œ
- [WebRTC API - MDN](https://developer.mozilla.org/en-US/docs/Web/API/WebRTC_API)
- [Socket.io Documentation](https://socket.io/docs/)
- [React YouTube Player](https://www.npmjs.com/package/react-youtube)

### í•™ìŠµ ìë£Œ
- [WebRTC for the Curious](https://webrtcforthecurious.com/)
- [WebRTC Samples](https://webrtc.github.io/samples/)
- [Google Developers - WebRTC](https://developers.google.com/web/updates/2015/07/mediastream-deprecations)

---

## ğŸ“„ ë¼ì´ì„ ìŠ¤

MIT License
